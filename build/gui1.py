
# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer

import os
import csv
import tkinter as tk
from tkinter import filedialog
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage
from PIL import Image as PilImage, ImageTk
from IPython.display import display, Image as IPImage, HTML
import easygui
from pathlib import Path
from fastai.vision.all import *


OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r".\assets\frame1")


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)


path = Path('src\Model\insectaCamModel.pkl')
learn = load_learner(path)


def update_image(ipath):
    global img
    img = PilImage.open(ipath).resize((200, 200))
    img = ImageTk.PhotoImage(img)
    canvas.itemconfig(tagOrId=image_7, image=img)


def file_dialog():
    path = easygui.fileopenbox(msg="Choose file", title="InsectaCam",  filetypes=[
                               "*.png", "*.jpg"], multiple=False, default="//*.png")
    # Aggiungi questa linea per utilizzare il percorso del file selezionato
    process_file(path)
    update_image(path)


def process_file(file_path):
    _, _, probs = learn.predict(PILImage.create(
        file_path))  # Esegui la previsione
    # Stampa le probabilitÃ  per ogni classe
    canvas.itemconfig(tagOrId=lsPercentage, text=f"{100*probs[0]:.1f}%")
    canvas.itemconfig(tagOrId=mdPercentage, text=f"{100*probs[1]:.1f}%")
    canvas.itemconfig(tagOrId=pcPercentage, text=f"{100*probs[2]:.1f}%")

    if (100*probs[0] > 50):
        canvas.itemconfig(tagOrId=speciesDetected,
                          text="Lucilia Sericata Detected")
    if (100*probs[1] > 50):
        canvas.itemconfig(tagOrId=speciesDetected,
                          text="Musca Domestica Detected")
    if (100*probs[2] > 50):
        canvas.itemconfig(tagOrId=speciesDetected,
                          text="Piophila Casei Detected")


window = Tk()

window.geometry("994x480")
window.configure(bg="#F2E8CF")


canvas = Canvas(
    window,
    bg="#F2E8CF",
    height=480,
    width=994,
    bd=0,
    highlightthickness=0,
    relief="ridge"
)

canvas.pack()

canvas.place(x=0, y=0)
image_image_1 = PhotoImage(
    file=relative_to_assets("image_1.png"))
image_1 = canvas.create_image(
    339.0,
    206.0,
    image=image_image_1
)

image_image_2 = PhotoImage(
    file=relative_to_assets("image_2.png"))
image_2 = canvas.create_image(
    551.0,
    48.0,
    image=image_image_2
)

canvas.create_text(
    115.0,
    11.0,
    anchor="nw",
    text="InsectaCam",
    fill="#F2E8CF",
    font=("Inter", 50 * -1)
)

canvas.create_text(
    284.0,
    197.0,
    anchor="nw",
    text="Insect species\n",
    fill="#000000",
    font=("Inter", 16 * -1)
)

image_image_3 = PhotoImage(
    file=relative_to_assets("image_3.png"))
image_3 = canvas.create_image(
    611.0,
    206.0,
    image=image_image_3
)

speciesDetected = canvas.create_text(
    497.0,
    197.0,
    anchor="nw",
    text="species detected",
    fill="#F2E8CF",
    font=("Inter", 16 * -1)
)

image_image_4 = PhotoImage(
    file=relative_to_assets("image_4.png"))
image_4 = canvas.create_image(
    115.0,
    415.0,
    image=image_image_4
)


buttonUpload = Button(
    window,
    image=image_image_4,
    command=file_dialog,
    borderwidth=0


)

buttonUpload.place(x=74, y=390)

canvas.create_text(
    550.0,
    133.0,
    anchor="nw",
    text="Numbers of flies detected ",
    fill="#F2E8CF",
    font=("Inter", 16 * -1)
)

canvas.create_text(
    485.0,
    133.0,
    anchor="nw",
    text="65",
    fill="#F2E8CF",
    font=("Inter", 16 * -1)
)

image_image_5 = PhotoImage(
    file=relative_to_assets("image_5.png"))
image_5 = canvas.create_image(
    61.0,
    48.0,
    image=image_image_5
)


image_image_7 = PhotoImage(
    file=relative_to_assets("image_7.png"))
image_7 = canvas.create_image(
    113.554443359375,
    281.0,
    image=image_image_7
)


image_image_9 = PhotoImage(
    file=relative_to_assets("image_9.png"))
image_9 = canvas.create_image(
    115.0,
    147.0,
    image=image_image_9
)

canvas.create_text(
    29.0,
    138.0,
    anchor="nw",
    text="Selected image",
    fill="#F2E8CF",
    font=("Inter", 16 * -1)
)

image_image_10 = PhotoImage(
    file=relative_to_assets("image_10.png"))
image_10 = canvas.create_image(
    339.0,
    276.0,
    image=image_image_10
)

image_image_11 = PhotoImage(
    file=relative_to_assets("image_11.png"))
image_11 = canvas.create_image(
    611.0,
    324.0,
    image=image_image_11
)

canvas.create_text(
    559.0,
    273.0,
    anchor="nw",
    text="Lucilia Sericata\n\n",
    fill="#F2E8CF",
    font=("Inter", 16 * -1)
)

canvas.create_text(
    558.0,
    343.0,
    anchor="nw",
    text="Piophila Casei\n",
    fill="#F2E8CF",
    font=("Inter", 16 * -1)
)

canvas.create_text(
    559.0,
    308.0,
    anchor="nw",
    text="Musca Domestica\n",
    fill="#F2E8CF",
    font=("Inter", 16 * -1)
)

lsPercentage = canvas.create_text(
    493.0,
    273.0,
    anchor="nw",
    text="0%",
    fill="#F2E8CF",
    font=("Inter", 16 * -1, "bold")
)

mdPercentage = canvas.create_text(
    493.0,
    309.0,
    anchor="nw",
    text="0%",
    fill="#F2E8CF",
    font=("Inter", 16 * -1, "bold")
)

pcPercentage = canvas.create_text(
    492.0,
    345.0,
    anchor="nw",
    text="0%",
    fill="#F2E8CF",
    font=("Inter", 16 * -1, "bold")
)

canvas.create_text(
    256.0,
    265.0,
    anchor="nw",
    text="Insect species detected",
    fill="#000000",
    font=("Inter", 16 * -1)
)


window.resizable(False, False)
window.mainloop()